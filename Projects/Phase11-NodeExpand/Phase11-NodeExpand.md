<div dir="rtl" align='justify'>

# فاز یازده: گسترش راس‌ها
در این فاز ما خواهیم توانست تا یک حساب را به عنوان یک راس روی بوم گراف وارد کنیم. سپس با گسترش دادن (Expand) این راس، تمامی حساب‌های دیگری که با این حساب تراکنش داشته‌اند روی صفحه نشان داده شوند.

در واقع قرار است چیزی شبیه به آن چه در زیر مشاهده می‌کنید را پیاده‌سازی کنیم.

<p align="center" style="text-align:center;"><img src="expand3.gif" alt="Logo" align="cneter"></p>

<br>

## 1- مرور کارهای انجام شده
ما تا این قسمت از پروژه تا جای خوبی پیش رفته‌ایم،  با محیط آشنا شده‌ایم، می‌توانیم تراکنش‌ها را به صورت گرافیکی روی محور صفحه ایجاد کنیم و هر یک از آن‌ها را به وسیله دو راس و یک یال گراف شناسایی کنیم.
با این تفاسیر کاملا آماده شده‌ایم تا این فاز را پیاده‌سازی کنیم.

<br>

## 2- وارد کردن مجموعه داده 
در این فاز هم مانند فاز قبل یک فایل csv حاوی تراکنش‌های بانکی فرضی در اختیارتان قرار می‌گیرد. اما این یکی شامل تعداد زیادی تراکنش بانکی می‌شود و قرار است کارهای جدیدی روی آن انجام دهیم. همچنین یک مجموعه داده دیگر حاوی اطلاعات حساب‌های موجود در تراکنش‌هاست. 

می‌توانید فایل را از این زیر دانلود کنید.

<a href="testData1.zip" download>Click to Download</a>

<br>

## 3- نمایش یک حساب به عنوان راس گراف
در فاز قبلی ما هر تراکنش را به صورت دمبل نشان می‌دادیم. در این فاز باید بتوانیم در ابتدا یک حساب را به تنهایی به عنوان راس گراف روی صفحه نشان بدهیم. بدین صورت که کاربر بتواند یک شماره حساب را در برنامه جست‌وجو کند و در صورت وجود آن شماره حساب، یک راس گراف که روی آن اسم مالک حساب نوشته شده در صفحه ظاهر شود.

برنامه باید طوری باشد که اگر کاربر به تعداد دلخواه، شماره حساب جست‌وجو کرد، در صورت وجود روی صفحه راس گراف ظاهر شود.
همچنین این ویژگی‌ که با کلیک روی راس، اطلاعات حساب نمایش داده شود باید وجود داشته‌باشد.

<br>

## 4-  قابلیت کلیک راست روی راس
بعد از این که کاربر یک شماره حساب را جست‌وجو کرد و راس گراف روی صفحه نمایش داده شد، باید ویژگی‌ای را در نظر بگیرید که کاربر بتواند روی آن کلیک راست کند و لیست حاوی سه گزینه‌ نمایان شود.

1. پاک کردن راس
1. انتخاب کردن راس
1. گسترش دادن راس

پاک کردن راس از روی بوم گراف که بدیهی است. با انتخاب آن، صرفا راس از روی صفحه پاک می‌شود. انتخاب کردن راس برای فاز‌های بعدی کاربرد مهمی دارد و فعلا با آن کاری نداریم. گسترش دادن راس در ادامه همین داک توضیح داده خواهدشد.

در این زیر شما بخشی از نرم افزار تحلیل داده خارجی را مشاهد‌ه می‌کنید که کاربر بعد از جست‌وجوی یک نام، نتیجه مطلوب خود را انتخاب می‌کند و روی صفحه یک راس گراف ظاهر می‌شود. سپس با راست کلیک کردن روی آن راس، لیستی حاوی چند گزینه نمایان می‌شود.


<p align="center" style="width:70% text-align:center;" ><img src="palantir.gif" alt="Logo"  align="cneter"  style="center"></p>

البته در این ویدیو، چون کاربر یک نام را جست‌وجو می‌کند زیر "search bar" چندین نتیجه نمایان می‌شود. ما چون با یک حساب بانکی سر و کار داریم و شماره حساب یکتا محسوب می‌شود، یا یک نتیجه نمایان خواهد شد یا نتیجه‌ای نخواهیم داشت.

<br>

## 5-  گسترش دادن راس
ما تا این بخش، به کاربر استفاده کننده از نرم‌افزار این توانایی را داده‌ایم که یک شماره حساب را جست‌وجو کند، آن را به عنوان یک راس روی صفحه بیندازد، روی آن راست کلیک کند و لیستی حاوی سه گزینه نمایان شود.

با انتخاب گزینه گسترش، باید تمامی حساب‌هایی که در پایگاه داده ما با حساب موجود روی صفحه تراکنش داشتند، به همراه یال تراکنش‌ بین آن‌ها، روی صفحه نشان داده شود. یال تراکنش باید جهت‌دار باشد و جهت آن از حساب مبدا به حساب مقصد باشد. همچنین میزان مبلغ تراکنش روی یال بین آن‌ها نوشته شود.

<br>

## 6-  چالش‌های پیاده‌سازی گسترش راس‌ها
به طور پیش‌فرض برای پیاده‌سازی این بخش، باید در پایگاه‌ داده تمامی تراکنش‌هایی را که حساب مورد نظر در آن‌ها حضور داشتند پیداکنیم و دمبل تراکنش‌ بین‌ آن‌ها را تشکیل‌دهیم. با این کار مثلا اگر حساب موردنظر 90 تراکنش انجام‌شده در پایگاه داده داشته باشد، 90 دمبل روی صفحه ایجاد می‌شود که نتیجه‌ی جالبی نیست و به درد تحلیل‌گر نمی‌خورد. برای این کار ما باید تمامی دنبل‌هایی را که یک سرشان حساب موردنظر است، ادغام (merge) کنیم تا چیزی شبیه تصویر اول داک به وجود بیاید.

به تصویر زیر دقت‌کنید.

<p align="center" style="text-align:center;"><img src="convertgif.gif" alt="Logo"  align="cneter"></p>

 در پروژه ما فقط باید گراف ادغام شده را به کاربر نشان بدهیم و مرحله ادغام شدن در این تصویر برای فهم بهتر است. نتیجه‌ای که به کاربر نشان داده می‌شود باید شبیه گیف موجود در اول داک باشد.

اما چگونه باید ادغام را پیاده‌سازی کنیم؟ (خوب است لحظاتی به این سوال فکر کنیم)

برای این کار کافی است راس‌هایی را که دقیقا تکرار شده‌ی راس اولیه بوده‌اند، یعنی نمایان‌گر یک حساب واحدند تبدیل به یک راس کنیم و بقیه راس‌های موجود در نتیجه جست‌‌و‌جو را به آن متصل کنیم. برای شناسایی این که کدام راس‌ها یکی هستند، باید آن‌ها را از طریق شماره حساب شناسایی کنیم. شماره حساب در این پروژه برای هر حساب مجزا، عددی واحد در نظر گرفته شده‌ است.

<br>

## 7-  حالت خاص
وقتی قرار است تراکنش‌های انجام‌شده توسط یک حساب را رسم کنیم، حالت خاصی به وجود می‌آید که حساب مورد نظر ما با یک حساب خاص، چند تراکنش داشته باشد. 
برای این حالت‌ها، با انگولار می‌توانید به سادگی یال‌های انحنادار بین دو راس را به راحتی ایجاد کنید تا چیزی شبیه به تصویر زیر ایجاد کنید.

<p align="center" style="text-align:center;"><img src="curve.jpg" alt="Logo"  align="cneter"></p>

<br>

# پیاده‌سازی گسترش گراف

شما باید به کمک
Ogma و ابزار‌های جاوا اسکریپت پنلی ایجاد کنید که به کمک آن بتوان راس‌ها و همسایه‌های یک راس را به گراف
موجود در صفحه Ogma اضافه کرد.

<div dir="rtl">
به دو روش می‌توانیم از انبار داده‌ها، داده (راس و یال) به گراف مصور شده اضافه کنیم.</div>

<br>

### 1-روش اول 
با کمک جست‌وجو، یعنی
شما باید یک پنجره جست‌وجو بسازید که در آن بتوان روی داده‌ها جست‌وجو کرد و نتایج را وارد گراف کرد و نشان داد. جست‌وجویی که شما اینجا باید پشتیبانی کنید جست‌وجوی ساده و یا <strong>exact search</strong> است. به طور مثال
کاربر باید بتواند شماره حساب مد نظر خود را وارد کند و شما آن را جست‌وجو کنید و در صورتی که حسابی با آن شماره
وجود داشت باید اطلاعات آن را از سرور بگیرید و آن راس را به شکل اضافه کنید. (در
صورت علاقه می‌توانید فیلتر‌های بیشتری را پشتیبانی کنید.)
<br>نکته:</br>
 در صورتی که
 راس <strong>A</strong> قبلا به گراف ما اضافه شده باشد و بعدا با جست‌وجوی دیگری راس <strong>B</strong> به گراف
ما اضافه شد؛ چنانچه که یالی بین <strong>A و B</strong> وجود داشته باشد باید نشان داده شود. (وقتی کاربر از
 محصول ما استفاده می‌کند و می‌خواهد به کمک آن روابط را تحلیل کند نیاز دارد تمامی یال‌های بین راس‌های موجود
را ببیند.)

<br>

### 2- روش دوم
شما باید یک جست‌وجوی
مخصوص گسترش ایجاد کنید (<strong>Expand</strong>)، به این صورت کار می‌کند که فرض کنید تعدادی از رئوس در حالت
<strong>انتخاب شده</strong> هستند و ما می‌خواهیم بعضی از همسایه‌های آن‌ها را که شرایط خاصی دارند به شکل
اضافه کنیم. شما باید این قابلیت را داشته باشید که کاربر بتواند تعدادی راس را انتخاب کند
و بعد <strong>گسترش</strong> را بزند و یک پنجره فیلتر بیاید که از کاربر فیلتر‌های مربوط به گسترش را
بگیرد. فیلتر‌هایی که شما باید حتما پشتیبانی کنید عبارت اند از:

الف) میزان مبلغ
تراکنش (یعنی شرط کمتر و یا بیشتر و یا مساوی با یک مبلغی را بتوان به عنوان فیلتر اضافه کرد.)

ب) تاریخ تراکنش
    (یعنی قبل یا بعد یک تاریخ را باید به عنوان یک فیلتر در نظر بگیرید. تاریخ‌ها همه میلادی هستند). پیشنهاد
    می‌شود از <strong><a href="https://blog.logrocket.com/javascript-date-libraries/">این</a></strong> کتاب‌خانه‌ها استفاده کنید.

ج) اسم صاحب حساب
    (یعنی شما باید بتوانید روی&nbsp;اسم صاحب حسابی که می‌خواهید بیارید سرچ انجام دهید). برای غنای بیشتر کار
    می‌توانید سرچ‌های <strong>startwith</strong> و <strong>endwith </strong> و <strong>contains</strong> را هم
    پشتیبانی کنید.&nbsp;&nbsp;

<br>

## نکات پایانی

توصیه من به شما این
است که api های خود را به صورت کلی و عمومی طراحی کنید تا قابلیت‌های بیشتری را با پیاده‌سازی کمتر و باگ کمتر
پشتیبانی کنید.
به طور مثال شما هم
باید یک جست‌وجوی ساده برای اضافه کردن یک سری راس انجام بدهید و هم یک سری جست‌وجوی پیچیده‌تر برای گسترش گراف.
شما می‌توانید به این صورت به داستان نگاه کنید که جست‌وجوی اولی یک حالت خاص از جست‌وجوی دومی است و در جست‌وجوی دومی شما
باید از بین راس‌ها تنها آن‌هایی را بیارید که همسایه رئوس انتخاب شده اند و این به
این صورت است که شما یک لیست از شماره حساب‌ها را دارید و باید در <strong>query</strong> ای که به الاستیک
می‌زنید آن را لحاظ کنید و فقط آن یال‌هایی را بیارید که حداقل یک کدام از <strong>sourceId</strong> و
<strong>targetId</strong> آن‌ها در داخل این لیست است ولی در جست‌وجو اولی چنین لیستی وجود ندارد ولی باقی
<strong>query</strong> شبیه هم هست و سعی کنید با یک ساختار خوب از <strong>duplication</strong> پرهیز کنید.

</div>
